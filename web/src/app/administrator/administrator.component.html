<h1>{{ "ADMINISTRATOR_PAGE.TITLE" | translate }}</h1>

<form #f="ngForm" (ngSubmit)="load(currentPage)" class="mb-3" novalidate>
    <button type="submit" class="btn btn-primary btn-sm">{{ "UPDATE" | translate }}</button>
    <button *appIfRole="'admin'" type="button" class="btn btn-warning btn-sm" (click)="openEdit()">{{ "NEW" | translate }}</button>
</form>

<pagination [boundaryLinks]="true" [totalItems]="count" [(ngModel)]="currentPage" [maxSize]="maxSize" [itemsPerPage]="pageMax" (pageChanged)="load($event.page)" class="pagination-sm" previousText="&lsaquo;" nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;"></pagination>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>{{ "ADMINISTRATOR.ID" | translate }}</th>
                <th>{{ "ADMINISTRATOR.NAME" | translate }}</th>
                <th>{{ "ADMINISTRATOR.ROLE" | translate }}</th>
                <th>{{ "ADMINISTRATOR.NOTE" | translate }}</th>
                <th>{{ "ADMINISTRATOR.CREATED_AT" | translate }}</th>
                <th>{{ "ADMINISTRATOR.DELETED_AT" | translate }}</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let row of rows" [class]="row.deletedAt ? 'disabled' : ''">
                <td>{{ row.id }}</td>
                <td>{{ row.name }}</td>
                <td>
                    <app-admin-role [role]="row.role"></app-admin-role>
                </td>
                <td class="multiline">{{ row.note }}</td>
                <td>{{ row.createdAt | date:'short' }}</td>
                <td>{{ row.deletedAt | date:'short' }}</td>
                <td>
                    <button *appIfRole="'admin'" type="button" class="btn btn-warning btn-sm" (click)="openEdit(row)" [disabled]="!!row.deletedAt">{{ "EDIT" | translate }}</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<pagination [boundaryLinks]="true" [totalItems]="count" [(ngModel)]="currentPage" [maxSize]="maxSize" [itemsPerPage]="pageMax" (pageChanged)="load($event.page)" class="pagination-sm" previousText="&lsaquo;" nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;"></pagination>

<div bsModal #editModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="administratorEditModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title pull-left">{{ "ADMINISTRATOR_PAGE.EDIT_TITLE" | translate }}</h4>
                <button type="button" class="close pull-right" aria-label="Close" (click)="closeEdit()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" *ngIf="admin">
                <form #f="ngForm" (ngSubmit)="submit()" novalidate>
                    <div class="form-group row">
                        <label for="admin.name" class="col-form-label col-3">{{ "ADMINISTRATOR.NAME" | translate }}:</label>
                        <div class="col-9">
                            <input type="text" id="admin.name" class="form-control" name="name" [(ngModel)]="admin.name" #name="ngModel" required>
                            <div class="warning" *ngIf="name.errors">
                                <div [hidden]="!name.errors.required">{{ "VALIDATE.REQUIRED" | translate }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <label class="col-form-label col-3">{{ "ADMINISTRATOR.ROLE" | translate }}:</label>
                        <div class="col-9">
                            <div class="form-check form-check-inline">
                                <input type="radio" id="admin.role.admin" class="form-check-input" name="status" [(ngModel)]="admin.role" value="admin"><label class="form-check-label" for="admin.role.admin">{{ "ADMINISTRATOR.ROLE_ADMIN" | translate }}</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input type="radio" id="admin.role.writable" class="form-check-input" name="status" [(ngModel)]="admin.role" value="writable"><label class="form-check-label" for="admin.role.writable">{{ "ADMINISTRATOR.ROLE_WRITABLE" | translate }}</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input type="radio" id="admin.role.readonly" class="form-check-input" name="status" [(ngModel)]="admin.role" value="readonly"><label class="form-check-label" for="admin.role.readonly">{{ "ADMINISTRATOR.ROLE_READONLY" | translate }}</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="admin.note" class="col-form-label col-3">{{ "ADMINISTRATOR.NOTE" | translate }}:</label>
                        <div class="col-9">
                            <textarea id="admin.note" class="form-control" name="note" [(ngModel)]="admin.note" #note="ngModel" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="form-group row" *ngIf="admin.createdAt">
                        <label class="col-3">{{ "ADMINISTRATOR.CREATED_AT" | translate }}:</label>
                        <div class="col-9">{{ admin.createdAt | date:'short' }}</div>
                    </div>
                    <div class="form-group row" *ngIf="admin.updatedAt">
                        <label class="col-3">{{ "ADMINISTRATOR.UPDATED_AT" | translate }}:</label>
                        <div class="col-9">{{ admin.updatedAt | date:'short' }}</div>
                    </div>
                    <div class="form-group row" *ngIf="admin.deletedAt">
                        <label class="col-3">{{ "ADMINISTRATOR.DELETED_AT" | translate }}:</label>
                        <div class="col-9">{{ admin.deletedAt | date:'short' }}</div>
                    </div>
                    <div class="form-group">
                        <div class="offset-2 col-10">
                            <button type="submit" class="btn btn-primary btn-sm" [disabled]="!f.form.valid || isButtonClicked">{{ "SUBMIT" | translate }}</button>
                            <button *ngIf="admin.id" type="button" class="btn btn-warning btn-sm" (click)="resetPassword()" [disabled]="isButtonClicked">{{ "ADMINISTRATOR_PAGE.PASSWORD_RESET" | translate }}</button>
                            <button *ngIf="admin.id" type="button" class="btn btn-danger btn-sm" (click)="delete()" [disabled]="isButtonClicked">{{ "DELETE" | translate }}</button>
                            <button type="button" class="btn btn-secondary btn-sm" (click)="closeEdit()">{{ "CANCEL" | translate }}</button>
                        </div>
                    </div>
                    <div class="alert alert-warning" role="alert" *ngIf="error">{{ error | translate }}</div>
                </form>
            </div>
        </div>
    </div>
</div>